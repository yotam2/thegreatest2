// Load required modules (and then we refer to them by these variables)
var http = require('http');
var fs = require('fs');
var ejs = require('ejs');

// Read the template from disk (and then we refer to it by this variable)
var formpage = fs.readFileSync(__dirname + '/form.ejs', 'utf8');
var listpage = fs.readFileSync(__dirname + '/list.ejs', 'utf8');


// Start our HTTP server (and then this function is called for every request)
http.createServer(function (req, res) {
    
    // req is the request
    // res will be the response
    
    // Send the HTTP header to the browser
    res.writeHead(200, {'Content-Type': 'text/html'});
    
    // the url string
    var urlParts = req.url.split('/');
    
    if(urlParts[1] == '') {
	    res.write(ejs.render(formpage, {
		    //put stuff in her if you have local variables you need to set in ejs
	    });
    } else {
	    var submission = url.parse(urlParts).query; //not sure exactly how this works, but this will be some object with the text you want
	    
	    //store your new submission to the database
	    
	    //search the database for all the things that people have submitted and get the number of times for each
	    
	    //listOfItems is an array containing all the words that people have submitted
	    var listOfItems = resultsOfDatabaseSearch();
	    
	    //pass the list of items to the ejs and make the list page
	    res.write(ejs.render(listpage, {
		    list: listOfItems
	    });
	    
    }
    
    
    // Close the HTTP connection (hang up the phone on the browser)
    res.end();
  
}).listen(process.env.PORT);